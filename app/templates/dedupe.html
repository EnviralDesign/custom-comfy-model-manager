<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dedupe - ComfyUI Model Manager</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="/static/js/htmx.min.js"></script>
</head>

<body>
    <nav class="top-bar">
        <div class="logo">
            <span class="logo-icon">‚ö°</span>
            <span class="logo-text">ComfyUI Model Manager</span>
        </div>
        <div class="nav-links">
            <a href="/sync" class="nav-link">Sync</a>
            <a href="/dedupe" class="nav-link active">Dedupe</a>
        </div>
        <div class="nav-actions">
            <div id="queue-widget" class="queue-widget">
                <span class="queue-icon">üìã</span>
                <span class="queue-count">0</span>
            </div>
        </div>
    </nav>

    <main class="dedupe-layout">
        <div class="dedupe-container">
            <!-- Side Selection -->
            <div class="dedupe-step" id="step-select">
                <h2>Select Side to Scan</h2>
                <p>Choose which storage location to scan for duplicate files.</p>
                <div class="side-buttons">
                    <button class="btn btn-large" id="scan-local">
                        üìÅ Scan Local
                    </button>
                    <button class="btn btn-large" id="scan-lake">
                        üåä Scan Lake
                    </button>
                </div>
                <div class="scan-options"
                    style="margin-top: 20px; color: var(--text-secondary); display: flex; flex-direction: column; gap: 12px;">
                    <div>
                        <label
                            style="display: flex; align-items: center; justify-content: flex-start; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="scan-mode-fast">
                            <span>‚ö° Fast Scan (Partial Hash)</span>
                        </label>
                        <p style="font-size: 12px; margin-top: 4px; opacity: 0.7; margin-left: 24px;">Uses first/last
                            4MB of files to find duplicates quickly.</p>
                    </div>
                    <div>
                        <label style="display: flex; align-items: center; justify-content: flex-start; gap: 8px;">
                            <span>Ignore files smaller than:</span>
                            <input type="number" id="scan-min-size" value="1" min="0" step="1"
                                style="width: 60px; padding: 4px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--text-primary);">
                            <span>MB</span>
                        </label>
                        <p style="font-size: 12px; margin-top: 4px; opacity: 0.7; margin-left: 0;">Filters out configs
                            and tiny files.</p>
                    </div>
                </div>
            </div>

            <!-- Scanning Progress -->
            <div class="dedupe-step hidden" id="step-scanning">
                <h2>Scanning for Duplicates...</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="scan-progress"></div>
                </div>
                <p id="scan-status">Hashing files...</p>
            </div>

            <!-- Results / Wizard -->
            <div class="dedupe-step hidden" id="step-wizard">
                <div class="wizard-header" style="display: flex; justify-content: space-between; align-items: start;">
                    <div>
                        <h2>Duplicate Groups</h2>
                        <span class="wizard-progress">Group <span id="current-group">1</span> of <span
                                id="total-groups">0</span></span>
                    </div>
                    <button class="btn btn-sm" id="discard-scan"
                        style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);">‚úï
                        Discard Scan</button>
                </div>

                <div class="duplicate-group" id="current-duplicate-group">
                    <!-- Filled by JS -->
                </div>

                <div class="wizard-nav">
                    <button class="btn" id="prev-group" disabled>‚Üê Previous</button>
                    <button class="btn btn-primary" id="next-group">Next ‚Üí</button>
                </div>
            </div>

            <!-- Review & Confirm -->
            <div class="dedupe-step hidden" id="step-review">
                <h2>Review Deletions</h2>
                <div class="review-summary">
                    <p><strong>Files to delete:</strong> <span id="delete-count">0</span></p>
                    <p><strong>Space to reclaim:</strong> <span id="reclaim-size">0 MB</span></p>
                </div>
                <div class="review-warning">
                    ‚ö†Ô∏è This action is permanent. Files will be hard-deleted.
                </div>
                <div class="review-actions">
                    <button class="btn" id="back-to-wizard">‚Üê Back</button>
                    <button class="btn btn-danger" id="confirm-delete">Delete Files</button>
                </div>
            </div>

            <!-- Complete -->
            <div class="dedupe-step hidden" id="step-complete">
                <h2>‚úÖ Deduplication Complete</h2>
                <p id="complete-message"></p>
                <button class="btn btn-primary" id="start-over">Start Over</button>
            </div>
        </div>
    </main>

    <script src="/static/js/app.js"></script>
    <script src="/static/js/dedupe.js"></script>
</body>

</html>